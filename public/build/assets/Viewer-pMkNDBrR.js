import{r as l,j as e,S as O,x as A}from"./app-DfZg0_iv.js";import{A as T}from"./AuthenticatedLayout-BJo3BYVB.js";import"./ApplicationLogo-DupAcbHH.js";import"./transition-UVFmWLJ4.js";function Z({auth:B,document:b,pageCount:d}){const L=l.useRef(null),[c,v]=l.useState(!1),[C,m]=l.useState(!0),[I,E]=l.useState(!navigator.onLine),[h,M]=l.useState(1),[k,y]=l.useState("1"),[W,j]=l.useState(!0),[i,x]=l.useState("scroll"),N=l.useRef({}),S=l.useRef(null),z=()=>{const t=Array.from({length:d||0},(s,o)=>o+1);if(i!=="spread")return t.map(s=>[s]);const n=[];n.push([1]);for(let s=1;s<t.length;s+=2){const o=[t[s]];t[s+1]&&o.push(t[s+1]),n.push(o)}return n};l.useEffect(()=>{const t=()=>E(!1),n=()=>E(!0);window.addEventListener("online",t),window.addEventListener("offline",n);let s;const o=()=>{j(!0),clearTimeout(s),s=setTimeout(()=>j(!1),3e3)};c?window.addEventListener("mousemove",o):j(!0);const p={root:S.current,threshold:.5},r=new IntersectionObserver(a=>{a.forEach(w=>{if(w.isIntersecting){const g=parseInt(w.target.getAttribute("data-page"));M(g),y(g.toString())}})},p),f=N.current;return Object.values(f).forEach(a=>{a&&r.observe(a)}),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n),window.removeEventListener("mousemove",o),Object.values(f).forEach(a=>{a&&r.unobserve(a)})}},[c,d]);const P=()=>{document.fullscreenElement?(document.exitFullscreen(),v(!1)):(L.current.requestFullscreen().catch(t=>{alert(`Error attempting to enable full-screen mode: ${t.message} (${t.name})`)}),v(!0))},u=(t,n=null)=>{n&&x(n);const s=Math.max(1,Math.min(t,d||1));setTimeout(()=>{const o=N.current[s];o&&o.scrollIntoView({behavior:"smooth",block:"start"})},n?50:0),M(s),y(s.toString())},F=()=>u(h+1),K=()=>u(h-1),R=t=>{t.key==="Enter"&&u(parseInt(k)||1)},V=()=>{const t=parseInt(k);!isNaN(t)&&t!==h&&u(t)};return l.useEffect(()=>{const t=()=>m(!1),n=()=>m(!0),s=()=>{m(!document.hidden)},o=r=>{const f=r.key==="PrintScreen",a=r.metaKey&&r.shiftKey&&(r.key==="3"||r.key==="4"||r.key==="5"),w=r.shiftKey&&r.metaKey&&r.key==="S",g=r.ctrlKey&&r.shiftKey&&r.key==="I"||r.key==="F12",$=(r.ctrlKey||r.metaKey)&&r.key==="c";if(f||a||w||g||$){if($){r.preventDefault();return}m(!1),setTimeout(()=>{alert("Screenshots and snipping are restricted on this platform to protect intellectual property.")},100)}};window.addEventListener("blur",t),window.addEventListener("focus",n),document.addEventListener("visibilitychange",s),window.addEventListener("keydown",o);const p=()=>{v(!!window.document.fullscreenElement)};return document.addEventListener("fullscreenchange",p),()=>{window.removeEventListener("blur",t),window.removeEventListener("focus",n),document.removeEventListener("visibilitychange",s),window.removeEventListener("keydown",o),document.removeEventListener("fullscreenchange",p)}},[]),e.jsxs(T,{user:B.user,header:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-2 w-full",children:[e.jsxs("div",{className:"flex items-center gap-4 min-w-[200px] flex-1",children:[e.jsx(A,{href:route("documents.library"),className:"bg-gray-200 dark:bg-gray-700 p-2 rounded-full hover:bg-gray-300 transition shrink-0",title:"Back to Library",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),e.jsx("span",{className:"font-semibold text-lg sm:text-xl text-gray-800 dark:text-gray-200 leading-tight truncate",children:b.title})]}),e.jsx("div",{className:"flex justify-center order-3 sm:order-2 w-full sm:w-auto",children:e.jsxs("button",{onClick:P,className:"flex items-center justify-center gap-2 px-3 py-1.5 border border-black/10 text-[10px] font-black uppercase tracking-[0.2em] rounded-md hover:bg-[#1a1a1a] hover:text-white transition-all shadow-sm bg-white whitespace-nowrap w-full sm:w-auto",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M9 9L4 4m0 0l5 0m-5 4l0-4m11 5l5-5m0 0l-5 0m5 4l0-4m-11 11l-5 5m0 0l5 0m-5-4l0 5m11-5l5 5m0 0l-5 0m5-4l0 5"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),c?"Exit Fullscreen":"Maximize Reader"]})}),e.jsx("div",{className:"flex justify-end order-2 sm:order-3",children:I&&e.jsx("span",{className:"bg-amber-100 text-amber-800 text-[10px] px-3 py-1 rounded-full font-black uppercase tracking-widest border border-amber-200",children:"Offline"})})]}),children:[e.jsx(O,{title:`Reading ${b.title}`}),e.jsxs("div",{className:`py-6 no-print ${c?"h-screen p-0 m-0 fixed inset-0 z-[100] bg-black":"h-[calc(100vh-160px)]"}`,ref:L,children:[e.jsx("style",{children:`
                    @media print {
                        body { display: none !important; }
                        .no-print { display: none !important; }
                    }
                    /* Prevent selection */
                    body {
                        user-select: none;
                        -webkit-user-select: none;
                        -moz-user-select: none;
                        -ms-user-select: none;
                    }
                    /* Hide scrollbar but keep functionality */
                    .hide-scrollbar::-webkit-scrollbar {
                        display: none;
                    }
                    .hide-scrollbar {
                        -ms-overflow-style: none;
                        scrollbar-width: none;
                    }
                `}),e.jsxs("div",{className:`${c?"w-full h-full p-0":"max-w-7xl mx-auto sm:px-6 lg:px-8 h-full"} relative transition-all duration-300 ${C?"":"blur-2xl"}`,onContextMenu:t=>t.preventDefault(),children:[!C&&e.jsx("div",{className:"absolute inset-0 z-[110] flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-2xl text-center border-2 border-indigo-500 max-w-md mx-4",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto text-indigo-500 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 00-2 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),e.jsx("h3",{className:"text-2xl font-black text-gray-900 dark:text-gray-100 uppercase tracking-tight mb-2",children:"Protected Mode"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-bold italic",children:"Content is hidden while window is out of focus to prevent unauthorized screenshots."}),e.jsx("p",{className:"mt-4 text-indigo-600 dark:text-indigo-400 font-bold animate-pulse",children:"Click here to resume reading"})]})}),e.jsxs("div",{className:`bg-white dark:bg-gray-900 overflow-hidden shadow-xl h-full border border-gray-200 dark:border-gray-700 relative ${c?"rounded-none border-none":"sm:rounded-lg"}`,children:[e.jsxs("div",{ref:S,className:`w-full h-full overflow-y-auto overflow-x-hidden ${i!=="scroll"?"snap-y snap-always":"snap-y snap-proximity"} scroll-smooth bg-gray-800 hide-scrollbar`,children:[z().map((t,n)=>e.jsx("div",{className:`w-full flex justify-center bg-gray-800 snap-start pt-2 ${i!=="scroll"?"h-full items-start":"mb-4"}`,children:e.jsx("div",{className:`flex gap-1 items-start ${i==="spread"?"max-w-[98%] h-[95%] w-full justify-center":"h-[95%] w-auto"}`,children:t.map(s=>e.jsxs("div",{ref:o=>N.current[s]=o,"data-page":s,onClick:()=>u(s,"scroll"),className:`relative shadow-2xl cursor-pointer group/page ${i==="fit"||i==="spread"?"h-full w-auto":"max-w-[95vw] lg:max-w-4xl w-full"}`,children:[e.jsx("img",{src:route("documents.page",{document:b.id,page:s}),alt:`Page ${s}`,className:`${i==="fit"||i==="spread"?"h-full w-auto object-contain":"w-full h-auto"} pointer-events-none rounded-sm bg-white transition-all duration-500 group-hover/page:ring-4 group-hover/page:ring-[#be1e2d]/20`,loading:s<=3?"eager":"lazy"}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2 items-center pointer-events-none",children:[e.jsx("div",{className:"bg-black/30 text-white text-[8px] px-2 py-0.5 rounded backdrop-blur-sm opacity-0 group-hover/page:opacity-100 transition-opacity",children:i==="scroll"?"Next Page":"Click to Zoom"}),e.jsx("div",{className:"bg-black/30 text-white text-[8px] px-2 py-0.5 rounded backdrop-blur-sm",children:s})]})]},s))})},n)),d===0&&e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-white p-10 text-center",children:[e.jsxs("svg",{className:"animate-spin h-10 w-10 mb-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("p",{className:"font-bold",children:"Preparing Digital Archive..."})]})]}),e.jsxs("div",{className:`absolute bottom-8 left-1/2 -translate-x-1/2 z-50 flex flex-nowrap items-center gap-2 sm:gap-4 px-3 sm:px-5 py-2 bg-black/70 backdrop-blur-md rounded-full border border-white/20 transition-all duration-500 max-w-[95vw] overflow-x-auto hide-scrollbar ${W?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,children:[e.jsx("button",{onClick:K,className:"p-1.5 hover:bg-white/10 rounded-full transition text-white disabled:opacity-30 shrink-0",disabled:h<=1,title:"Previous Page",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 text-white font-black uppercase tracking-widest text-[8px] sm:text-[10px] px-2 sm:px-3 border-x border-white/10 shrink-0",children:[e.jsx("span",{className:"opacity-60 hidden xs:inline",children:"Page"}),e.jsx("input",{type:"number",value:k,onChange:t=>y(t.target.value),onKeyDown:R,onBlur:V,className:"w-8 sm:w-10 bg-white/10 border-none p-0.5 text-center focus:ring-1 focus:ring-[#be1e2d] text-white font-black rounded text-[10px] sm:text-xs",min:"1",max:d}),e.jsxs("span",{className:"opacity-60",children:["/ ",d||"?"]})]}),e.jsx("button",{onClick:F,className:"p-1.5 hover:bg-white/10 rounded-full transition text-white disabled:opacity-30 shrink-0",disabled:h>=d,title:"Next Page",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M9 5l7 7-7 7"})})}),e.jsxs("div",{className:"hidden sm:flex items-center bg-white/10 rounded-lg p-1 border border-white/10 shrink-0",children:[e.jsx("button",{onClick:()=>x("scroll"),className:`p-1 sm:p-1.5 rounded-md transition-all ${i==="scroll"?"bg-[#be1e2d] text-white":"text-white/40 hover:text-white"}`,title:"Infinite Scroll",children:e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsx("button",{onClick:()=>x("fit"),className:`p-1 sm:p-1.5 rounded-md transition-all ${i==="fit"?"bg-[#be1e2d] text-white":"text-white/40 hover:text-white"}`,title:"Single Page",children:e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("button",{onClick:()=>x("spread"),className:`p-1 sm:p-1.5 rounded-md transition-all ${i==="spread"?"bg-[#be1e2d] text-white":"text-white/40 hover:text-white"}`,title:"2-Page Spread",children:e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})})]}),c&&e.jsx("button",{onClick:P,className:"p-1 sm:p-1.5 bg-red-600 hover:bg-red-700 rounded-full transition text-white shadow-lg shrink-0",title:"Exit Fullscreen",children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})]})]})]})]})}export{Z as default};
