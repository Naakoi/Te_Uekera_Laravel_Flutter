import{r as d,j as e,S as j,x as h}from"./app-DfZg0_iv.js";import{A as k}from"./AuthenticatedLayout-BJo3BYVB.js";import"./ApplicationLogo-DupAcbHH.js";import"./transition-UVFmWLJ4.js";function O({auth:u,documents:i}){const[b,p]=d.useState([]),[f,c]=d.useState(null),[o,m]=d.useState(!navigator.onLine);d.useEffect(()=>{var l;const r=()=>m(!1),s=()=>m(!0);window.addEventListener("online",r),window.addEventListener("offline",s),"caches"in window&&caches.open("newspaper-library").then(t=>{t.keys().then(x=>{const g=x.map(n=>n.url),y=i.filter(n=>g.some(w=>w.includes(`/documents/${n.id}/page/1`))).map(n=>n.id);p(y)})});const a=t=>{if(t.data.type==="CACHE_SUCCESS"){const x=t.data.docId;p(g=>[...g,x]),c(null)}else t.data.type==="CACHE_ERROR"&&(alert("Failed to save for offline viewing. Please check your connection."),c(null))};return(l=navigator.serviceWorker)==null||l.addEventListener("message",a),()=>{var t;window.removeEventListener("online",r),window.removeEventListener("offline",s),(t=navigator.serviceWorker)==null||t.removeEventListener("message",a)}},[i]);const v=r=>{if(!("serviceWorker"in navigator)||!navigator.serviceWorker.controller){alert("Offline features are not supported in this browser or pending activation.");return}c(r.id),navigator.serviceWorker.controller.postMessage({type:"CACHE_IMAGES",docId:r.id,pageCount:r.page_count})};return e.jsxs(k,{user:u.user,header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:"My Digital Library"}),o&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-400 text-xs font-black uppercase tracking-widest rounded-full border border-amber-200 dark:border-amber-800",children:[e.jsxs("span",{className:"relative flex h-2 w-2",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-amber-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-amber-500"})]}),"Offline Mode"]})]}),children:[e.jsx(j,{title:"My Library"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[o&&e.jsxs("div",{className:"mb-8 bg-indigo-600 rounded-xl p-6 text-white shadow-xl flex items-center gap-6",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-full",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black uppercase tracking-tight",children:"Offline Reading Enabled"}),e.jsx("p",{className:"opacity-90 font-medium",children:"You can still read any newspapers marked with a green checkmark below."})]})]}),i.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:i.map(r=>{const s=b.includes(r.id),a=!o||s;return e.jsxs("div",{className:`bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg border border-gray-200 dark:border-gray-700 flex flex-col group transition-all duration-300 ${a?"":"opacity-60 grayscale"}`,children:[e.jsxs(h,{href:a?route("documents.reader",r.id):"#",className:`block aspect-[3/4] overflow-hidden bg-gray-100 dark:bg-gray-700 relative ${a?"":"cursor-not-allowed"}`,onClick:l=>!a&&l.preventDefault(),children:[r.thumbnail_path?e.jsx("img",{src:`/storage/${r.thumbnail_path}`,alt:r.title,className:"w-full h-full object-cover group-hover:scale-105 transition duration-300"}):e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center text-gray-400 p-4 text-center",children:e.jsx("svg",{className:"w-12 h-12 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10l4 4v10a2 2 0 01-2 2z"})})}),a&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 flex items-center justify-center transition-all duration-300",children:e.jsx("span",{className:"bg-white text-black px-4 py-2 rounded-full font-bold opacity-0 group-hover:opacity-100 shadow-xl transform translate-y-4 group-hover:translate-y-0 transition-all duration-300",children:"Open Newspaper"})}),!a&&e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center p-4 text-center",children:e.jsx("span",{className:"text-white text-xs font-black uppercase tracking-widest bg-black/60 px-3 py-2 rounded-lg backdrop-blur-sm",children:"Not Available Offline"})}),s&&e.jsx("div",{className:"absolute top-2 right-2 bg-green-500 text-white p-1 rounded-full shadow-lg",title:"Available Offline",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"})})})]}),e.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-gray-100 truncate",children:r.title}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx(h,{href:a?route("documents.reader",r.id):"#",className:`block w-full text-center px-4 py-2 rounded-md transition font-bold ${a?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,onClick:l=>!a&&l.preventDefault(),children:a?"Read Now":"Offline"}),!s&&!o?e.jsx("button",{onClick:()=>v(r),disabled:f===r.id,className:"block w-full text-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition text-sm font-bold",children:f===r.id?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 text-indigo-500",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"ðŸ’¾ Save for Offline"}):s?e.jsx("div",{className:"text-center py-2 text-xs font-bold text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/20 rounded",children:"âœ“ Available in App Library"}):null]})]})]},r.id)})}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-12 text-center rounded-lg shadow",children:[e.jsx("svg",{className:"w-20 h-20 mx-auto text-gray-300 mb-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Your Library is Empty"}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"Purchase a newspaper to see it here."}),e.jsx(h,{href:route("documents.index"),className:"mt-8 inline-block px-6 py-3 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 font-bold",children:"Browse Newspapers"})]})]})})]})}export{O as default};
