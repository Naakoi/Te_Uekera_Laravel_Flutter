import{r as i,j as e,x as l}from"./app-DfZg0_iv.js";import{A as M}from"./ApplicationLogo-DupAcbHH.js";import{q as A}from"./transition-UVFmWLJ4.js";const j=i.createContext(),x=({children:t})=>{const[r,n]=i.useState(!1),s=()=>{n(o=>!o)};return e.jsx(j.Provider,{value:{open:r,setOpen:n,toggleOpen:s},children:e.jsx("div",{className:"relative",children:t})})},D=({children:t})=>{const{open:r,setOpen:n,toggleOpen:s}=i.useContext(j);return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:s,children:t}),r&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>n(!1)})]})},O=({align:t="right",width:r="48",contentClasses:n="py-1 bg-white dark:bg-gray-700",children:s})=>{const{open:o,setOpen:h}=i.useContext(j);let d="origin-top";t==="left"?d="ltr:origin-top-left rtl:origin-top-right start-0":t==="right"&&(d="ltr:origin-top-right rtl:origin-top-left end-0");let c="";return r==="48"&&(c="w-48"),e.jsx(e.Fragment,{children:e.jsx(A,{as:i.Fragment,show:o,enter:"transition ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsx("div",{className:`absolute z-50 mt-2 rounded-md shadow-lg ${d} ${c}`,onClick:()=>h(!1),children:e.jsx("div",{className:"rounded-md ring-1 ring-black ring-opacity-5 "+n,children:s})})})})},U=({className:t="",children:r,...n})=>e.jsx(l,{...n,className:"block w-full px-4 py-2 text-start text-sm leading-5 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:bg-gray-100 dark:focus:bg-gray-800 transition duration-150 ease-in-out "+t,children:r});x.Trigger=D;x.Content=O;x.Link=U;function p({active:t=!1,className:r="",children:n,...s}){return e.jsx(l,{...s,className:"inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium leading-5 transition duration-150 ease-in-out focus:outline-none "+(t?"border-indigo-400 dark:border-indigo-600 text-gray-900 dark:text-gray-100 focus:border-indigo-700 ":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-700 focus:text-gray-700 dark:focus:text-gray-300 focus:border-gray-300 dark:focus:border-gray-700 ")+r,children:n})}function u({active:t=!1,className:r="",children:n,...s}){return e.jsx(l,{...s,className:`w-full flex items-start ps-3 pe-4 py-2 border-l-4 ${t?"border-indigo-400 dark:border-indigo-600 text-indigo-700 dark:text-indigo-300 bg-indigo-50 dark:bg-indigo-900/50 focus:text-indigo-800 dark:focus:text-indigo-200 focus:bg-indigo-100 dark:focus:bg-indigo-900 focus:border-indigo-700 dark:focus:border-indigo-300":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 hover:border-gray-300 dark:hover:border-gray-600 focus:text-gray-800 dark:focus:text-gray-200 focus:bg-gray-50 dark:focus:bg-gray-700 focus:border-gray-300 dark:focus:border-gray-600"} text-base font-medium focus:outline-none transition duration-150 ease-in-out ${r}`,children:n})}const a=[];for(let t=0;t<256;++t)a.push((t+256).toString(16).slice(1));function _(t,r=0){return(a[t[r+0]]+a[t[r+1]]+a[t[r+2]]+a[t[r+3]]+"-"+a[t[r+4]]+a[t[r+5]]+"-"+a[t[r+6]]+a[t[r+7]]+"-"+a[t[r+8]]+a[t[r+9]]+"-"+a[t[r+10]]+a[t[r+11]]+a[t[r+12]]+a[t[r+13]]+a[t[r+14]]+a[t[r+15]]).toLowerCase()}let y;const E=new Uint8Array(16);function T(){if(!y){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");y=crypto.getRandomValues.bind(crypto)}return y(E)}const R=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),C={randomUUID:R};function z(t,r,n){var o;t=t||{};const s=t.random??((o=t.rng)==null?void 0:o.call(t))??T();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,_(s)}function I(t,r,n){return C.randomUUID&&!t?C.randomUUID():z(t)}const w=()=>{let t=localStorage.getItem("device_id");return t||(t=I(),localStorage.setItem("device_id",t)),t},W=async(t=null)=>{var n;const r=w();try{return(await(await fetch("/redeem-code/status",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content")},body:JSON.stringify({device_id:r,document_id:t})})).json()).activated}catch(s){return console.error("Failed to check activation status:",s),!1}};function $({isOpen:t,onClose:r,onActivated:n,documentId:s=null,documentTitle:o=null}){const[h,d]=i.useState(""),[c,m]=i.useState(null),[g,f]=i.useState(!1);if(!t)return null;const b=async v=>{var N;v.preventDefault(),f(!0),m(null);const L=w();try{const k=await fetch("/redeem-code",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(N=document.querySelector('meta[name="csrf-token"]'))==null?void 0:N.getAttribute("content")},body:JSON.stringify({code:h,device_id:L,document_id:s})}),S=await k.json();k.ok?(n(),r()):m(S.message||"Failed to redeem code.")}catch{m("An error occurred. Please try again.")}finally{f(!1)}};return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md",children:e.jsxs("div",{className:"bg-[#f4f1ea] w-full max-w-md rounded-[2.5rem] overflow-hidden shadow-2xl border-4 border-[#be1e2d] relative animate-in fade-in zoom-in duration-300",children:[e.jsxs("div",{className:"bg-[#be1e2d] px-8 py-6 text-white text-center",children:[e.jsx("h2",{className:"text-3xl font-black uppercase tracking-tighter italic",children:s?"Unlock Edition":"Activate Device"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.2em] opacity-80 mt-1",children:o?`Accessing: ${o}`:"Te Uekera Digital Edition Access"})]}),e.jsxs("form",{onSubmit:b,className:"p-8 space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-serif italic text-gray-700 leading-relaxed mb-6",children:s?"Enter your single-use code to unlock this specific digital edition for this device.":"Enter your single-use activation code to unlock this device for full digital access."}),e.jsx("div",{className:"relative",children:e.jsx("input",{type:"text",placeholder:"ENTER CODE...",value:h,onChange:v=>d(v.target.value.toUpperCase()),className:"w-full bg-white border-2 border-black/10 rounded-2xl p-6 font-mono font-black text-2xl tracking-[0.3em] text-center focus:ring-4 focus:ring-[#be1e2d]/20 focus:border-[#be1e2d] transition-all",required:!0})}),c&&e.jsx("div",{className:"mt-4 bg-red-100 border-l-4 border-red-500 p-4 text-red-700 text-xs font-black uppercase tracking-widest italic",children:c})]}),e.jsx("button",{type:"submit",disabled:g,className:"w-full bg-[#1a1a1a] text-[#ffde00] py-6 rounded-2xl font-black uppercase tracking-[0.2em] text-lg hover:bg-[#be1e2d] hover:text-white transition-all shadow-xl shadow-black/20 hover:shadow-[#be1e2d]/30 active:scale-95 disabled:opacity-50",children:g?"Verifying...":"Unlock Now"}),e.jsxs("p",{className:"text-[9px] text-center font-black uppercase tracking-widest text-gray-400",children:["Once activated, this device will have permanent access to the ",s?"edition":"content",". ",e.jsx("br",{}),"Codes are single-use only."]})]}),e.jsx("button",{onClick:r,className:"absolute top-4 right-4 text-white/50 hover:text-white transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M6 18L18 6M6 6l12 12"})})})]})})}function V({user:t,header:r,children:n}){const[s,o]=i.useState(!1),[h,d]=i.useState(!0),[c,m]=i.useState(!1);return i.useEffect(()=>{(async()=>{const f=w();if(document.cookie=`device_id=${f}; path=/; max-age=31536000; SameSite=Lax`,t.role==="admin"||t.role==="staff"){d(!0);return}const b=await W();d(b)})()},[t.role,route().current()]),e.jsxs("div",{className:"min-h-screen bg-[#f4f1ea] font-sans",children:[e.jsxs("nav",{className:"bg-[#be1e2d] text-white border-b-2 border-black shadow-lg print:hidden",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between h-20",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"shrink-0 flex items-center gap-3",children:e.jsxs(l,{href:"/",className:"flex items-center gap-3 group",children:[e.jsx(M,{className:"block h-10 w-auto border-2 border-white/20 rounded shadow-sm group-hover:border-white/40 transition-colors"}),e.jsx("span",{className:"text-2xl font-black uppercase tracking-tighter text-white",style:{textShadow:"1px 1px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000"},children:"Te Uekera"})]})}),e.jsxs("div",{className:"hidden space-x-6 sm:-my-px sm:ms-10 sm:flex",children:[e.jsx(p,{href:route("dashboard"),active:route().current("dashboard"),className:"text-white hover:bg-white/10 px-3 py-1 rounded transition-all font-black uppercase tracking-widest text-xs self-center",children:"Dashboard"}),e.jsx(p,{href:route("documents.index"),active:route().current("documents.index"),className:"text-white hover:bg-white/10 px-3 py-1 rounded transition-all font-black uppercase tracking-widest text-xs self-center",children:"Newspapers"}),e.jsx(p,{href:route("documents.library"),active:route().current("documents.library"),className:"text-white hover:bg-white/10 px-3 py-1 rounded transition-all font-black uppercase tracking-widest text-xs self-center",children:"My Library"}),(t.role==="admin"||t.can_manage_users)&&e.jsx(p,{href:route("staff.users.index"),active:route().current("staff.users.index"),className:"text-[#ffde00] hover:bg-white/10 px-3 py-1 rounded transition-all font-black uppercase tracking-widest text-xs self-center",children:"Manage Users"}),(t.role==="admin"||t.can_create_vouchers)&&e.jsx(p,{href:route("admin.redeem_codes.index"),active:route().current("admin.redeem_codes.index"),className:"text-[#ffde00] hover:bg-white/10 px-3 py-1 rounded transition-all font-black uppercase tracking-widest text-xs self-center",children:"Manage Codes"})]})]}),e.jsx("div",{className:"hidden sm:flex sm:items-center sm:ms-6",children:e.jsx("div",{className:"ms-3 relative",children:e.jsxs(x,{children:[e.jsx(x.Trigger,{children:e.jsx("span",{className:"inline-flex rounded-sm",children:e.jsxs("button",{type:"button",className:"inline-flex items-center px-4 py-2 border-2 border-white/30 text-xs font-black uppercase tracking-widest rounded-sm text-white bg-black/20 hover:bg-black/40 transition",children:[t.name,e.jsx("svg",{className:"ms-2 -me-0.5 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]})})}),e.jsxs(x.Content,{children:[e.jsx(x.Link,{href:route("profile.edit"),children:"Profile Settings"}),e.jsx(x.Link,{href:route("logout"),method:"post",as:"button",children:"Log Out Safely"})]})]})})}),e.jsx("div",{className:"-me-2 flex items-center sm:hidden",children:e.jsx("button",{onClick:()=>o(g=>!g),className:"inline-flex items-center justify-center p-2 rounded-md text-white hover:bg-white/10 transition",children:e.jsxs("svg",{className:"h-6 w-6",stroke:"currentColor",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("path",{className:s?"hidden":"inline-flex",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h16M4 18h16"}),e.jsx("path",{className:s?"inline-flex":"hidden",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})]})})})]})}),e.jsx("div",{className:(s?"block":"hidden")+" sm:hidden",children:e.jsxs("div",{className:"pt-2 pb-3 space-y-1 bg-white border-b-2 border-black",children:[e.jsx(u,{href:route("dashboard"),active:route().current("dashboard"),children:"Dashboard"}),e.jsx(u,{href:route("documents.index"),active:route().current("documents.index"),children:"Newspapers"}),e.jsx(u,{href:route("documents.library"),active:route().current("documents.library"),children:"My Library"}),(t.role==="admin"||t.can_manage_users)&&e.jsx(u,{href:route("staff.users.index"),active:route().current("staff.users.index"),children:"User Management"}),(t.role==="admin"||t.can_create_vouchers)&&e.jsx(u,{href:route("admin.redeem_codes.index"),active:route().current("admin.redeem_codes.index"),children:"Manage Codes"}),e.jsx("hr",{className:"border-black/5 mx-4 my-2"}),e.jsx(u,{href:route("profile.edit"),children:"Profile"}),e.jsx(u,{method:"post",href:route("logout"),as:"button",children:"Log Out"})]})})]}),r&&e.jsx("header",{className:"bg-white border-b-4 border-double border-black shadow-sm print:hidden",children:e.jsxs("div",{className:"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 text-[#1e3a8a] flex items-center justify-between",children:[e.jsx("div",{className:"shrink-0 border-l-8 border-[#be1e2d] pl-6",children:e.jsx("div",{className:"text-3xl font-black uppercase tracking-tighter leading-none italic font-sans",children:r})}),e.jsxs("div",{className:"hidden md:block text-[10px] font-black uppercase opacity-30 italic text-right",children:["Official Archive Access",e.jsx("br",{}),"Established 2026"]})]})}),e.jsx("main",{className:"py-12 print:p-0",children:n}),e.jsxs("div",{className:"sm:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 h-16 flex items-center justify-around z-50 print:hidden",children:[e.jsxs(l,{href:route("dashboard"),className:`flex flex-col items-center justify-center w-full h-full ${route().current("dashboard")?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),e.jsx("span",{className:"text-xs mt-1",children:"Home"})]}),e.jsxs(l,{href:route("documents.index"),className:`flex flex-col items-center justify-center w-full h-full ${route().current("documents.index")?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:[e.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10l4 4v10a2 2 0 01-2 2z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M14 2v6h6"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 13H8m8 4H8m0-8h1"})]}),e.jsx("span",{className:"text-xs mt-1",children:"Shop"})]}),e.jsxs(l,{href:route("documents.library"),className:`flex flex-col items-center justify-center w-full h-full ${route().current("documents.library")?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),e.jsx("span",{className:"text-xs mt-1",children:"Library"})]}),e.jsxs(l,{href:route("profile.edit"),className:`flex flex-col items-center justify-center w-full h-full ${route().current("profile.edit")?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:[e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),e.jsx("span",{className:"text-xs mt-1",children:"Profile"})]})]}),e.jsx("div",{className:"sm:hidden h-20"}),!h&&!c&&e.jsxs("button",{onClick:()=>m(!0),className:"fixed bottom-6 right-6 z-[90] flex items-center gap-2 px-4 py-2 bg-white/10 backdrop-blur-xl border border-black/5 text-[#be1e2d] font-black uppercase tracking-[0.2em] text-[10px] rounded-full shadow-lg hover:bg-[#be1e2d] hover:text-white transition-all hover:-translate-y-1 active:scale-95 group",children:[e.jsx("div",{className:"bg-[#be1e2d]/10 p-1.5 rounded-full group-hover:bg-white/20 transition-colors",children:e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 00-2 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsx("span",{className:"opacity-80 group-hover:opacity-100",children:route().current("documents.show")?"Unlock Edition":"Activate Device"})]}),e.jsx($,{isOpen:c,onClose:()=>m(!1),onActivated:()=>{d(!0),window.location.reload()},documentId:route().params.document})]})}export{V as A,$ as a};
